<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>0度微发酵气泡果汁风味不专业版建模</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'PingFang SC', sans-serif; background: #f2f4f2; color: #2c3e50; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 35px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .layout { display: grid; grid-template-columns: 450px 1fr; gap: 40px; }
        .card { background: #fff; padding: 25px; border-radius: 15px; border: 1px solid #eef2f0; }
        .apple-box { margin-bottom: 20px; }
        .apple-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .tag { font-size: 11px; background: #f0f7f4; color: #27ae60; padding: 3px 8px; border-radius: 4px; border: 1px solid #d1e8dd; }
        input[type="range"] { width: 100%; accent-color: #27ae60; height: 6px; }
        .ferment-control { background: #fff9e6; border-radius: 12px; padding: 20px; margin-top: 25px; border: 1px solid #ffeaa7; }
        .analysis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .report-card { background: #f8fbf9; padding: 15px; border-radius: 10px; border-left: 4px solid #27ae60; }
        .report-card h4 { margin: 0 0 8px 0; color: #1e3a2b; font-size: 15px; }
        .report-card p { margin: 0; font-size: 13px; color: #5d6d7e; line-height: 1.5; }
        .summary-badge { display: inline-block; padding: 6px 15px; background: #1e3a2b; color: white; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:#1e3a2b;">0度气泡果汁：多品种混酿风味建模</h1>
    
    <div class="layout">
        <div class="card">
            <h3 style="margin-top:0;">1. 混酿比例 </h3>
            <div id="sliders"></div>

            <div class="ferment-control">
                <h4 style="margin:0 0 10px 0;">2. 微发酵程度控制</h4>
                <input type="range" id="ferment-depth" min="0" max="100" value="20">
                <div style="display:flex; justify-content:space-between; font-size:11px; margin-top:8px; color:#967d32;">
                    <span>基础果汁感 (线性)</span>
                    <span>发酵复杂感 (层次)</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">3. 专业感官评价报告</h3>
            <div id="summary" class="summary-badge">分析中...</div>
            <canvas id="radarChart"></canvas>
            
            <div class="analysis-grid">
                <div class="report-card">
                    <h4>酸度架构 (Acidity)</h4>
                    <p id="eval-acid">-</p>
                </div>
                <div class="report-card">
                    <h4>结构与收敛感 (Tannin/Body)</h4>
                    <p id="eval-body">-</p>
                </div>
                <div class="report-card">
                    <h4>香气层次 (Aromas)</h4>
                    <p id="eval-aroma">-</p>
                </div>
                <div class="report-card">
                    <h4>整体平衡度 (Balance)</h4>
                    <p id="eval-balance">-</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const db = {
        "海棠果 (野生)": { acid: 10, sweet: 2, body: 10, aroma: 0.9, sugar: 90, profile: "高浓度原花青素，提供核心支撑感。" },
        "澳洲青苹果": { acid: 9, sweet: 3, body: 2, aroma: 0.2, sugar: 110, profile: "纵向酸度极高，清理口腔残余甜腻。" },
        "布瑞本 (辛香)": { acid: 7, sweet: 5, body: 6, aroma: 0.5, sugar: 120, profile: "提供中段（Mid-palate）填充，增加风味宽度。" },
        "粉红佳人": { acid: 7, sweet: 6, body: 4, aroma: 0.4, sugar: 130, profile: "赋予前调红色浆果与精致花香。" },
        "红富士": { acid: 3, sweet: 9, body: 5, aroma: 0.8, sugar: 155, profile: "主要糖分载体，提供圆润的质地。" },
        "黄元帅": { acid: 4, sweet: 8, body: 7, aroma: 1.0, sugar: 140, profile: "代谢后易产生酯类物质，增加厚度。" }
    };

    const names = Object.keys(db);
    let ratios = names.map((_, i) => i === 4 ? 100 : 0); // 默认富士100%
    let chart;

    // 动态滑块逻辑
    names.forEach((name, i) => {
        const row = document.createElement('div');
        row.className = 'apple-box';
        row.innerHTML = `
            <div class="apple-info">
                <span><strong>${name}</strong></span>
                <span id="label-${i}" style="color:#27ae60; font-weight:bold;">0%</span>
            </div>
            <input type="range" class="slider" data-index="${i}" min="0" max="1000" value="${ratios[i]*10}">
            <div style="font-size:10px; color:#999; margin-top:2px;">${db[name].profile}</div>
        `;
        document.getElementById('sliders').appendChild(row);
    });

    function update(e) {
        if(e) {
            const idx = parseInt(e.target.dataset.index);
            const val = parseInt(e.target.value) / 10;
            const delta = val - ratios[idx];
            const otherTotal = 100 - ratios[idx];
            ratios[idx] = val;
            names.forEach((_, i) => {
                if(i !== idx) ratios[i] = otherTotal > 0 ? ratios[i] * (1 - delta / otherTotal) : (100 - val) / (names.length - 1);
            });
        }

        let a = 0, s = 0, b = 0, ar = 0, sug = 0;
        const f = document.getElementById('ferment-depth').value / 100;

        ratios.forEach((v, i) => {
            const r = v / 100;
            const d = db[names[i]];
            a += d.acid * r; s += d.sweet * r; b += d.body * r; ar += d.aroma * r; sug += d.sugar * r;
            document.getElementById(`label-${i}`).innerText = v.toFixed(1) + '%';
            document.querySelectorAll('.slider')[i].value = v * 10;
        });

        // 核心评价算法
        const finalSugar = sug * (1 - f * 0.1); // 0度果汁仅极微量发酵损耗
        const complexity = f * 10;
        
        // UI更新
        document.getElementById('summary').innerText = `综合糖酸比: ${(finalSugar/a/10).toFixed(1)} : 1 | 复杂度指数: ${complexity.toFixed(1)}`;
        
        // 评价词库
        document.getElementById('eval-acid').innerText = a > 8 ? "酸度呈现尖锐的纵向结构，生津感极强，能够瞬间穿透中段风味。" : a > 5 ? "酸度适中，呈现活泼的柠檬酸调性，起支撑作用。" : "酸度缺失，整体风味呈现扁平化，缺乏新鲜感。";
        document.getElementById('eval-body').innerText = b > 7 ? "骨架硬朗，单宁带来的收敛感明显，提升了产品的饮用门槛与高级感。" : b > 4 ? "酒体中等，具有一定的咀嚼感，结构平衡。" : "质地稀薄，缺乏结构支持，口感偏向传统软饮。";
        document.getElementById('eval-aroma').innerText = ar > 0.7 ? "香气以次生代谢产物为主，表现为熟化苹果、坚果及微量酯类香气。" : "香气保持了原果的线性特征，花果调性清晰。";
        document.getElementById('eval-balance').innerText = (finalSugar/a) > 20 ? "风味重心严重偏向甜感，气泡感可能无法完全抵消腻感。" : "糖酸配比科学，微发酵带来的复杂感有效弥补了甜度下降后的风味空缺。";

        renderChart([a, s, b, ar*10, complexity]);
    }

    function renderChart(data) {
        const ctx = document.getElementById('radarChart');
        if(chart) { chart.data.datasets[0].data = data; chart.update(); }
        else {
            chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['纵向酸度', '感知甜度', '结构硬度', '风味深度', '发酵复杂度'],
                    datasets: [{ data: data, backgroundColor: 'rgba(39, 174, 96, 0.2)', borderColor: '#27ae60', pointRadius: 0 }]
                },
                options: { scales: { r: { min: 0, max: 10, ticks: { display: false } } }, plugins: { legend: { display: false } } }
            });
        }
    }

    document.addEventListener('input', update);
    update();
</script>
</body>
</html>
