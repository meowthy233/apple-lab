<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¾®å‘é…µè‹¹æœæ±é£å‘³æ¨¡æ‹Ÿå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f9f9f9; color: #333; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2d5a27; }
        .config-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
        .apple-item { margin-bottom: 15px; padding: 10px; border: 1px solid #eee; border-radius: 8px; }
        .apple-item label { font-weight: bold; display: block; margin-bottom: 5px; }
        input[type="range"] { width: 100%; accent-color: #4CAF50; }
        .result-section { background: #f0f7ef; padding: 20px; border-radius: 10px; }
        #description { font-style: italic; color: #555; margin-top: 10px; line-height: 1.6; }
        .stats-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; background: #2d5a27; color: white; font-size: 14px; margin-right: 5px; }
        canvas { max-width: 100%; margin-top: 20px; }
        .warning { color: #d9534f; font-size: 12px; margin-top: 5px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ è‹¹æœæ··é…¿é£å‘³å®éªŒå®¤</h1>
    <p style="text-align: center; color: #666;">è‡ªç”±è°ƒæ•´å“ç§æ¯”ä¾‹ï¼Œå®æ—¶è§‚æµ‹å‘é…µå‰åçš„é£å‘³å˜åŒ–</p>

    <div class="config-section">
        <div class="controls">
            <h3>1. å“ç§é…æ¯” (æ€»å’Œéœ€ä¸º 100%)</h3>
            <div id="apple-controls"></div>
            <p id="total-warn" class="warning">âš ï¸ å½“å‰æ¯”ä¾‹æ€»å’Œä¸ç­‰äº 100%ï¼Œç»“æœå¯èƒ½ä¸å‡†ç¡®</p>

            <h3>2. å‘é…µç¨‹åº¦ (å‘é…µæ·±åº¦)</h3>
            <label>æ®‹ç³–æ§åˆ¶ (å†³å®šç”œåº¦ä¸é…’ç²¾åº¦)</label>
            <input type="range" id="ferment-level" min="0" max="100" value="70">
            <div style="display: flex; justify-content: space-between; font-size: 12px;">
                <span>çº¯æœæ± (ä¸å‘é…µ)</span>
                <span>å®Œå…¨å‘é…µ (å¹²å‹)</span>
            </div>
        </div>

        <div class="result-section">
            <h3>3. å®æ—¶é£å‘³ç”»åƒ</h3>
            <canvas id="flavorChart"></canvas>
            
            <div id="results">
                <p><strong>é¢„æµ‹å£æ„Ÿæè¿°ï¼š</strong></p>
                <div id="description">è¯·è°ƒæ•´æ¯”ä¾‹ä»¥æŸ¥çœ‹æè¿°...</div>
                <hr>
                <p><strong>æ®‹ç³–è®¡ç®—å™¨ï¼š</strong></p>
                <span class="stats-badge" id="residual-sugar">æ®‹ç³–: -- g/L</span>
                <span class="stats-badge" id="est-abv">é¢„ä¼°é…’ç²¾åº¦: --%</span>
            </div>
        </div>
    </div>
</div>

<script>
    // å“ç§æ•°æ®åº“ [é…¸åº¦, ç”œåº¦, ç»“æ„, é¦™æ°”è°ƒæ€§(0æ¸…æ–°-1æµ“éƒ), åŸå§‹ç³–åº¦g/L]
    const appleData = {
        "æ¾³æ´²é’è‹¹æœ (æŸ æª¬é¦™)": { acid: 9, sweet: 3, body: 2, aroma: 0.1, sugar: 110 },
        "ç²‰çº¢ä½³äºº (èŠ±æœé¦™)": { acid: 7, sweet: 6, body: 4, aroma: 0.2, sugar: 130 },
        "çº¢å¯Œå£« (èœ‚èœœç”œ)": { acid: 3, sweet: 9, body: 5, aroma: 0.8, sugar: 155 },
        "å˜å•¦ (æ¸…ç”œè‰æœ¬)": { acid: 4, sweet: 7, body: 3, aroma: 0.3, sugar: 125 },
        "é»„å…ƒå¸… (å¥¶æ²¹ç†Ÿé¦™)": { acid: 4, sweet: 8, body: 6, aroma: 0.9, sugar: 140 }
    };

    let chart;
    const appleControls = document.getElementById('apple-controls');

    // åˆå§‹åŒ–æ»‘å—
    Object.keys(appleData).forEach((name, index) => {
        const div = document.createElement('div');
        div.className = 'apple-item';
        const startVal = index === 0 ? 100 : 0;
        div.innerHTML = `
            <label>${name} <span id="val-${index}">${startVal}%</span></label>
            <input type="range" class="apple-slider" data-name="${name}" data-index="${index}" min="0" max="100" value="${startVal}">
        `;
        appleControls.appendChild(div);
    });

    function update() {
        let totalRatio = 0;
        let finalAcid = 0, finalSweet = 0, finalBody = 0, finalAroma = 0, initialSugar = 0;
        
        const sliders = document.querySelectorAll('.apple-slider');
        const fermentLevel = document.getElementById('ferment-level').value / 100;

        sliders.forEach(slider => {
            const ratio = slider.value / 100;
            const data = appleData[slider.dataset.name];
            totalRatio += ratio;
            document.getElementById(`val-${slider.dataset.index}`).innerText = slider.value + '%';
            
            finalAcid += data.acid * ratio;
            finalSweet += data.sweet * ratio;
            finalBody += data.body * ratio;
            finalAroma += data.aroma * ratio;
            initialSugar += data.sugar * ratio;
        });

        document.getElementById('total-warn').style.display = Math.abs(totalRatio - 1) > 0.01 ? 'block' : 'none';

        // æ®‹ç³–ä¸é…’ç²¾åº¦è®¡ç®— (å¤§è‡´ç®—æ³•: 17g/L ç³–äº§ç”Ÿ 1% é…’ç²¾)
        const residualSugar = initialSugar * (1 - fermentLevel);
        const consumedSugar = initialSugar - residualSugar;
        const abv = consumedSugar / 17;
        const displaySweetness = finalSweet * (1 - fermentLevel); // ä¿®æ­£å‘é…µåçš„ä½“æ„Ÿç”œåº¦

        document.getElementById('residual-sugar').innerText = `æ®‹ç³–: ${residualSugar.toFixed(1)} g/L`;
        document.getElementById('est-abv').innerText = `é¢„ä¼°é…’ç²¾åº¦: ${abv.toFixed(1)}% Vol`;

        // æè¿°é€»è¾‘
        let desc = "";
        if (finalAcid > 6) desc += "âœ¨ å£æ„Ÿéå¸¸**æ˜äº®ç”Ÿæ´¥**ï¼Œå¸¦æœ‰æ˜æ˜¾çš„é…¸è´¨éª¨æ¶ã€‚";
        else desc += "â˜ï¸ å£æ„Ÿ**æ¸©å’Œåœ†æ¶¦**ï¼Œé…¸åº¦ä¸æ˜æ˜¾ã€‚";

        if (finalAroma > 0.6) desc += " é‡ç‚¹çªå‡º**ç†Ÿè‹¹æœã€èœ‚èœœ**çš„æµ“éƒåè°ƒã€‚";
        else desc += " æ•£å‘ç€**é’è‰ã€æŸ æª¬**èˆ¬çš„æ¸…æ–°å‰è°ƒã€‚";

        if (residualSugar < 10) desc += " å±äº**å¹²å‹**æ°”æ³¡é…’ï¼Œé€‚åˆä½é¤ã€‚";
        else if (residualSugar < 40) desc += " å±äº**åŠå¹²å‹**ï¼Œä¿ç•™äº†æœæ±çš„æ„‰æ‚¦æ„Ÿã€‚";
        else desc += " **ç”œæ„Ÿæ˜æ˜¾**ï¼Œæ›´æ¥è¿‘å¸¦æ°”çš„æœæ±ã€‚";

        document.getElementById('description').innerText = desc;

        updateChart([finalAcid, displaySweetness, finalBody, finalAroma * 10, abv * 2]);
    }

    function updateChart(dataValues) {
        const ctx = document.getElementById('flavorChart').getContext('2d');
        const labels = ['é…¸åº¦å¼ºåº¦', 'æ®‹ç•™ç”œåº¦', 'é…’ä½“é‡é‡', 'æµ“éƒåº¦', 'é…’ç²¾è´¨æ„Ÿ'];
        
        if (chart) {
            chart.data.datasets[0].data = dataValues;
            chart.update();
        } else {
            chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'é£å‘³å‰–é¢ (0-10)',
                        data: dataValues,
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        borderColor: '#4CAF50',
                        pointBackgroundColor: '#2d5a27'
                    }]
                },
                options: {
                    scales: { r: { min: 0, max: 10, ticks: { display: false } } }
                }
            });
        }
    }

    document.addEventListener('input', update);
    update();
</script>
</body>
</html>