<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¾®å‘é…µè‹¹æœæ··é…¿æ¨¡æ‹Ÿå™¨ - ä¸ä¸“ä¸šç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'PingFang SC', sans-serif; background: #f0f2f0; color: #333; padding: 10px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: #1a4314; font-size: 24px; }
        .layout { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 25px; }
        .card { background: #fff; border: 1px solid #eee; padding: 20px; border-radius: 12px; }
        .apple-box { margin-bottom: 18px; }
        .apple-info { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }
        .tag { font-size: 11px; background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 4px; }
        input[type="range"] { width: 100%; accent-color: #4CAF50; cursor: grab; }
        .ferment-section { background: #fffde7; border: 1px dashed #fbc02d; padding: 15px; border-radius: 10px; margin-top: 15px; }
        #radarChart { max-height: 350px; }
        .desc-box { margin-top: 15px; line-height: 1.6; font-size: 14px; color: #444; border-left: 4px solid #4CAF50; padding-left: 15px; }
        .data-badge { background: #1a4314; color: white; padding: 4px 10px; border-radius: 5px; font-size: 13px; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ ä¸ä¸“ä¸šæ··é…¿æ¯”ä¾‹æ¨¡æ‹Ÿå™¨ (æ€»é‡é”å®š 100%)</h1>
    
    <div class="layout">
        <div class="card">
            <h3 style="margin-top:0">1. å“ç§é…æ¯”è°ƒå– <small style="color:#666; font-weight:normal">(ä»»ä¸€è°ƒæ•´ï¼Œæ•´ä½“å¹³è¡¡)</small></h3>
            <div id="slider-group"></div>

            <div class="ferment-section">
                <h3 style="margin-top:0">2. å‘é…µä¸æ®‹ç³–æ§åˆ¶</h3>
                <label>å‘é…µç¨‹åº¦ (0%=çº¯æœæ± | 100%=å®Œå…¨å‘é…µ)</label>
                <input type="range" id="ferment-depth" min="0" max="100" value="60">
                <div style="display:flex; justify-content:space-between; font-size:11px; margin-top:5px;">
                    <span>é²œæ¦¨æœæ± (æç”œ)</span>
                    <span>å¹²å‹è‹¹æœé…’ (æ— ç³–)</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0">3. é£å‘³ç”»åƒä¸æ•°æ®</h3>
            <canvas id="radarChart"></canvas>
            
            <div style="margin-top:20px;">
                <span class="data-badge" id="abv-val">é¢„ä¼°é…’ç²¾: 0%</span>
                <span class="data-badge" id="sugar-val">æ®‹ç³–: 0 g/L</span>
            </div>

            <div class="desc-box" id="flavor-desc">æ­£åœ¨åˆ†ææ··åˆé£å‘³...</div>
        </div>
    </div>
</div>

<script>
    // æ‰©å±•å“ç§æ•°æ®åº“
    const appleDB = {
        "æµ·æ£ æœ (é‡ç”Ÿ/æé…¸æ¶©)": { acid: 10, sweet: 2, body: 10, aroma: 0.9, sugar: 90, tags: "é«˜å•å®, éª¨æ¶å¢å¼º" },
        "æ¾³æ´²é’è‹¹æœ (æŸ æª¬/çˆ½è„†)": { acid: 9, sweet: 3, body: 2, aroma: 0.2, sugar: 110, tags: "æŸ æª¬é¦™, å¢äº®" },
        "å¸ƒç‘æœ¬ (è¾›é¦™/éª¨æ¶)": { acid: 7, sweet: 5, body: 5, aroma: 0.4, sugar: 120, tags: "ç»“æ„æ„Ÿ, ä¸°å¯Œåº¦" },
        "ç²‰çº¢ä½³äºº (èŠ±é¦™/ç«ç‘°)": { acid: 7, sweet: 6, body: 4, aroma: 0.3, sugar: 130, tags: "ä¼˜é›…, çº¢æµ†æœ" },
        "çº¢å¯Œå£« (èœ‚èœœ/åº•è•´)": { acid: 3, sweet: 9, body: 4, aroma: 0.8, sugar: 155, tags: "ä¸»åŸºè°ƒ, é«˜ç³–" },
        "é»„å…ƒå¸… (å¥¶æ²¹/ç†Ÿé¦™)": { acid: 4, sweet: 8, body: 6, aroma: 0.9, sugar: 140, tags: "åœ†æ¶¦æ„Ÿ, å¥¶æ²¹é¦™" },
        "å˜å•¦ (æ¸…ç”œ/é¦™è‰)": { acid: 4, sweet: 7, body: 3, aroma: 0.3, sugar: 125, tags: "æ¸…æ–°å‰è°ƒ" }
    };

    const names = Object.keys(appleDB);
    let ratios = names.map((_, i) => i === 0 ? 100 : 0); // åˆå§‹ï¼šç¬¬ä¸€ä¸ª 100%ï¼Œå…¶ä½™ 0%
    let chart;

    const sliderGroup = document.getElementById('slider-group');

    // åˆå§‹åŒ–æ¸²æŸ“æ»‘å—
    names.forEach((name, i) => {
        const div = document.createElement('div');
        div.className = 'apple-box';
        div.innerHTML = `
            <div class="apple-info">
                <span><strong>${name}</strong> <span class="tag">${appleDB[name].tags}</span></span>
                <span id="label-${i}" style="font-weight:bold; color:#4CAF50">0%</span>
            </div>
            <input type="range" class="apple-slider" data-index="${i}" min="0" max="1000" value="${ratios[i] * 10}">
        `;
        sliderGroup.appendChild(div);
    });

    // æ ¸å¿ƒé€»è¾‘ï¼šæ€»é‡é”å®šç®—æ³•
    function handleSlider(e) {
        const index = parseInt(e.target.dataset.index);
        const newValue = parseInt(e.target.value) / 10;
        const oldValue = ratios[index];
        const delta = newValue - oldValue;

        if (delta === 0) return;

        // è®¡ç®—å…¶ä»–æ»‘å—çš„æ€»æ¯”ä¾‹
        const otherTotal = 100 - oldValue;
        ratios[index] = newValue;

        if (otherTotal > 0) {
            // æŒ‰æ¯”ä¾‹ç¼©æ”¾å…¶ä»–æ»‘å—
            for (let i = 0; i < ratios.length; i++) {
                if (i !== index) {
                    ratios[i] = ratios[i] * (1 - delta / otherTotal);
                }
            }
        } else {
            // å¦‚æœä¹‹å‰å…¶ä»–éƒ½æ˜¯0ï¼Œåˆ™å¹³åˆ†å‰©ä½™é‡
            const share = (100 - newValue) / (ratios.length - 1);
            for (let i = 0; i < ratios.length; i++) {
                if (i !== index) ratios[i] = share;
            }
        }
        updateUI();
    }

    function updateUI() {
        const sliders = document.querySelectorAll('.apple-slider');
        const ferment = document.getElementById('ferment-depth').value / 100;
        
        let finalA = 0, finalS = 0, finalB = 0, finalAr = 0, totalSug = 0;

        ratios.forEach((val, i) => {
            const v = Math.max(0, val);
            sliders[i].value = v * 10;
            document.getElementById(`label-${i}`).innerText = v.toFixed(1) + '%';
            
            const d = appleDB[names[i]];
            const r = v / 100;
            finalA += d.acid * r;
            finalS += d.sweet * r;
            finalB += d.body * r;
            finalAr += d.aroma * r;
            totalSug += d.sugar * r;
        });

        // æ®‹ç³–ä¸é…’ç²¾è®¡ç®—
        const resSugar = totalSug * (1 - ferment);
        const abv = (totalSug - resSugar) / 17;
        const displaySweet = finalS * (1 - ferment);

        document.getElementById('abv-val').innerText = `é¢„ä¼°é…’ç²¾: ${abv.toFixed(1)}%`;
        document.getElementById('sugar-val').innerText = `æ®‹ç³–: ${resSugar.toFixed(1)} g/L`;

        // é£å‘³æè¿°é€»è¾‘
        let desc = "ğŸ” æ··åˆç”»åƒï¼š";
        if (ratios[0] > 10) desc += "ç”±äºåŠ å…¥äº†æµ·æ£ æœï¼Œå£æ„Ÿå¸¦æœ‰æ˜æ˜¾çš„â€é‡ç”Ÿå•å®è´¨æ„Ÿâ€œï¼Œé€‚åˆå“é‰´ã€‚";
        if (finalA > 7) desc += "é…¸åº¦éå¸¸éœ¸æ°”ï¼Œè®©äººå£å£é½¿ã€‚";
        desc += finalAr > 0.6 ? " æ•´ä½“é£å‘³åå‘â€ç”œç†Ÿè‹¹æœä¸å¥¶æ²¹â€œçš„æµ“éƒé£æ ¼ã€‚" : " æ•´ä½“å‘ˆç°å‡ºâ€œé’è‰ä¸èŠ±æœâ€çš„æ¸…å‡‰æ„Ÿã€‚";

        document.getElementById('flavor-desc').innerHTML = desc;

        updateChart([finalA, displaySweet, finalB, finalAr * 10, abv * 2]);
    }

    function updateChart(data) {
        const ctx = document.getElementById('radarChart');
        if (chart) {
            chart.data.datasets[0].data = data;
            chart.update();
        } else {
            chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['é…¸åº¦å¼ºåº¦', 'æ®‹ç•™ç”œåº¦', 'å•å®/é…’ä½“', 'é¦™æ°”æ·±åº¦', 'é…’ç²¾æ„Ÿ'],
                    datasets: [{ label: 'æ··åˆé£å‘³æŒ‡çº¹', data: data, backgroundColor: 'rgba(76,175,80,0.2)', borderColor: '#4CAF50' }]
                },
                options: { scales: { r: { min: 0, max: 10 } }, plugins: { legend: { display: false } } }
            });
        }
    }

    document.querySelectorAll('.apple-slider').forEach(s => s.addEventListener('input', handleSlider));
    document.getElementById('ferment-depth').addEventListener('input', updateUI);
    updateUI();
</script>

</body>
</html>
